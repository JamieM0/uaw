<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Metrics Editor - Universal Automation Wiki</title>
        <meta
            name="description"
            content="Interactive metrics editor for creating and testing validation rules"
        />
        <link rel="stylesheet" href="/assets/css/main.css" />
        <link rel="stylesheet" href="/assets/css/components.css" />
        <link rel="stylesheet" href="/assets/css/simulation.css" />
        <link rel="stylesheet" href="/assets/css/playground.css" />
        <link rel="stylesheet" href="/assets/css/metrics-editor.css" />

        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />

        <script src="/assets/js/simulation-validator.js"></script>
        
        <!-- Monaco Editor - must load before metrics-editor.js -->
        <script src="https://unpkg.com/monaco-editor@0.44.0/min/vs/loader.js"></script>
        <script src="/assets/js/metrics-editor.js"></script>

    </head>
    <body>
        <header class="playground-header">
            <div class="header-container" style="max-width: none; width: 100%; padding: 0 var(--spacing-md);">
                <div class="logo">
                    <a href="/">
                        <img
                            src="/assets/images/logo-abbrev-inline.svg"
                            alt="Universal Automation Wiki Logo"
                        />
                    </a>
                </div>
                <h1 class="special-title">📊 Metrics Editor</h1>
                <div class="header-actions">
                    <div class="file-operations">
                        <button id="load-default-btn" title="Load default metrics catalog">📄 Load Default</button>
                        <button id="load-custom-btn" title="Load custom metrics catalog">📂 Load Custom</button>
                        <button id="import-package-btn" title="Import complete metrics package from file">📥 Import Package</button>
                        <button id="export-package-btn" title="Export catalog and validation code as package">📤 Export Package</button>
                    </div>

                    <div class="global-actions">
                        <button id="validate-all-btn" class="primary" title="Run complete validation on all metrics">✅ Validate All</button>
                        <button id="toggle-right-panel-btn" class="btn-secondary" title="Show/hide test data panel">
                            <span id="right-panel-toggle-text">👁️‍🗨️ Hide Test Data</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="playground-main">
            <div class="metrics-editor-container" id="metricsEditorContainer">
                <!-- Left Panel: Visual Catalog + JSON Editor -->
                <div class="editor-panel left-panel">
                    <div class="panel-header">
                        Metrics Catalog
                        <div class="panel-actions">
                            <button class="btn btn-primary" id="add-metric-btn" title="Add new metric to catalog">➕ Add</button>
                            <button class="btn btn-secondary" id="remove-metric-btn" title="Remove selected metric from catalog">🗑️ Remove</button>
                            <button class="btn btn-secondary" id="refresh-catalog-btn" title="Refresh visual catalog display">🔄 Refresh</button>
                            <button class="btn btn-secondary" id="expand-all-btn" title="Expand all metric categories">📂 Expand</button>
                            <button class="btn btn-secondary" id="collapse-all-btn" title="Collapse all metric categories">📁 Collapse</button>
                        </div>
                    </div>
                    
                    <div class="visual-catalog" id="visualCatalog">
                        <!-- Dynamically populated -->
                    </div>
                    
                    <div class="panel-header">
                        JSON Editor
                        <div class="panel-actions">
                            <button class="btn btn-secondary" id="format-json-btn" title="Format and beautify JSON content">🎨 Format</button>
                            <button class="btn btn-secondary" id="validate-json-btn" title="Check JSON syntax validity">✔️ Validate</button>
                        </div>
                    </div>
                    <div class="json-editor-container" id="jsonEditorContainer">
                        <!-- Monaco editor will be initialized here -->
                    </div>
                    <div class="resize-handle-vertical"></div>
                </div>

                <!-- Center Panel: JavaScript Editor -->
                <div class="editor-panel center-panel">
                    <div class="panel-header">
                        Validation Logic
                        <div class="panel-actions">
                            <button class="btn btn-secondary" id="format-js-btn" title="Format and beautify JavaScript code">🎨 Format</button>
                            <button class="btn btn-secondary" id="check-syntax-btn" title="Check JavaScript syntax for errors">🔍 Check Syntax</button>
                        </div>
                    </div>
                    
                    <div class="function-navigator">
                        Jump to function: 
                        <select class="function-dropdown" id="functionDropdown">
                            <option value="">Select function...</option>
                        </select>
                    </div>
                    
                    <div class="js-editor-container" id="jsEditorContainer">
                        <!-- Monaco editor will be initialized here -->
                    </div>
                    <div class="resize-handle-vertical"></div>
                </div>

                <!-- Right Panel: Test Data -->
                <div class="editor-panel right-panel" id="rightPanel">
                    <div class="panel-header">
                        Test Data
                        <div class="panel-actions">
                            <button class="btn btn-secondary" id="load-sample-btn" title="Load sample simulation data for testing">📋 Load Sample</button>
                            <button class="btn btn-secondary" id="clear-data-btn" title="Clear current test simulation data">🧹 Clear</button>
                        </div>
                    </div>
                    
                    <div class="test-data-content" id="testDataContent">
                        <div class="sample-simulation" data-sample="bake_bread">
                            <div class="sample-title">🍞 Bake Bread Process</div>
                            <div class="sample-description">
                                Complete bread baking workflow with ingredient preparation, mixing, rising, and baking phases.
                            </div>
                        </div>
                        
                        <div class="sample-simulation" data-sample="dyson_sphere">
                            <div class="sample-title">🌌 Dyson Sphere Construction</div>
                            <div class="sample-description">
                                Mega-engineering project simulation with resource assessment, construction phases, and energy management.
                            </div>
                        </div>
                        
                        <div class="sample-simulation" data-sample="custom">
                            <div class="sample-title">📝 Custom Test Data</div>
                            <div class="sample-description">
                                Load custom simulation data for testing your metrics validation logic.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Panel: Validation Console -->
                <div class="editor-panel validation-console">
                    <div class="resize-handle-horizontal"></div>
                    <div class="panel-header">
                        Validation Console
                        <div class="panel-actions">
                            <button class="btn btn-secondary" id="clear-console-btn" title="Clear all console messages">🧹 Clear</button>
                            <button class="btn primary" id="run-validation-btn" title="Execute validation logic against test data">▶️ Run Validation</button>
                        </div>
                    </div>
                    
                    <div class="console-content">
                        <div class="console-section">
                            <div class="console-section-header">Structure Analysis</div>
                            <div class="console-section-content" id="structureConsole">
                                Ready to analyze metrics structure...
                            </div>
                        </div>
                        
                        <div class="console-section">
                            <div class="console-section-header">Validation Results</div>
                            <div class="console-section-content" id="resultsConsole">
                                Ready to validate metrics...
                            </div>
                        </div>
                        
                        <div class="console-section">
                            <div class="console-section-header">Actions & Errors</div>
                            <div class="console-section-content" id="actionsConsole">
                                Ready to process actions...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Add Metric Modal -->
        <div id="add-metric-modal" class="dialog-overlay" style="display: none;">
            <div class="dialog" style="max-width: 700px;">
                <h3>Add New Metric</h3>
                <div class="modal-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="metric-id-input">Metric ID:</label>
                            <input type="text" id="metric-id-input" placeholder="e.g., custom.performance.time_efficiency">
                            <div class="auto-suggest" id="id-suggestion"></div>
                        </div>
                        <div class="form-group">
                            <label for="metric-category-input">Category:</label>
                            <input type="text" id="metric-category-input" list="category-suggestions" placeholder="e.g., Performance">
                            <datalist id="category-suggestions">
                                <option value="Performance">
                                <option value="Quality Control">
                                <option value="Resource Management">
                                <option value="Safety">
                                <option value="Workflow Analysis">
                                <option value="Financial">
                                <option value="Structural Integrity">
                                <option value="Scheduling">
                                <option value="Optimization">
                            </datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="metric-name-input">Display Name:</label>
                        <input type="text" id="metric-name-input" placeholder="e.g., Time Efficiency Check">
                    </div>
                    <div class="form-group">
                        <label for="metric-description-input">Description:</label>
                        <textarea id="metric-description-input" placeholder="Describe what this metric measures and validates..." rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="metric-severity-select">Severity:</label>
                            <select id="metric-severity-select">
                                <option value="info">Info</option>
                                <option value="warning">Warning</option>
                                <option value="error">Error</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="metric-validation-input">Validation Function Name:</label>
                            <input type="text" id="metric-validation-input" placeholder="e.g., validateTimeEfficiency">
                            <div class="auto-suggest" id="function-suggestion"></div>
                        </div>
                    </div>
                    
                    <!-- Parameters Section -->
                    <div class="parameters-section">
                        <div class="parameters-header">
                            <h4>Parameters (Optional)</h4>
                            <button type="button" class="btn-add-param" id="add-param-btn">+ Add Parameter</button>
                        </div>
                        <div id="parameters-container">
                            <!-- Dynamic parameter rows will be added here -->
                        </div>
                    </div>
                </div>
                <div class="dialog-buttons">
                    <button type="button" class="btn-secondary" id="metric-cancel-btn">Cancel</button>
                    <button type="button" class="btn-primary" id="metric-add-btn">Add Metric</button>
                </div>
            </div>
        </div>

    </body>
</html>