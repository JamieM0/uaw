<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automation ROI Analysis - Universal Automation Wiki</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/components.css">
    <link rel="stylesheet" href="/assets/css/category.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/documentation.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600;700&family=Geologica:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Placeholder styles to prevent layout shift */
        #header-placeholder { min-height: 70px; }
        #footer-placeholder { min-height: 250px; }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="docs-container">
        <div class="docs-layout">
            <div id="sidebar-placeholder"></div>

            <main class="docs-main">
                <article class="docs-article">
                    <header class="docs-header">
                        <div class="docs-breadcrumb">
                            <nav aria-label="Breadcrumb">
                                <ol>
                                    
                                        
                                            <li><a href="/">Home</a></li>
                                        
                                    
                                        
                                            <li><a href="/docs/">Documentation</a></li>
                                        
                                    
                                        
                                            <li><a href="/docs/routines/">Routines</a></li>
                                        
                                    
                                        
                                            <li aria-current="page">Automation ROI Analysis</li>
                                        
                                    
                                </ol>
                            </nav>
                        </div>
                        
                        <div class="docs-title-section">
                            <h1 class="docs-page-title">Automation ROI Analysis</h1>
                            
                            <p class="docs-page-subtitle">This script utilizes a Large Language Model (LLM) to generate a structured Return on Investment (ROI) analysis for implementing automation technologies related to a specific topic. It processes an input JSON file containing the topic and optional model parameters, interacts with the LLM, parses the response, and saves the structured analysis along with metadata to an output JSON file.</p>
                            
                        </div>
                    </header>

                    <div class="docs-content">
                        <p>This script utilizes a Large Language Model (LLM) to generate a structured Return on Investment (ROI) analysis for implementing automation technologies related to a specific topic. It processes an input JSON file containing the topic and optional model parameters, interacts with the LLM, parses the response, and saves the structured analysis along with metadata to an output JSON file.</p>
<h2 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">&para;</a></h2>
<p>The primary goal of <code class="docs-inline-code">return-analysis.py</code> is to automate the generation of ROI assessments for automation projects. It prompts an LLM to analyze the potential returns across small, medium, and large production scales, providing insights into investment, savings, benefits, barriers, and recommendations in a standardized JSON format.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>The script is executed from the command line:</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span><span class="k">return</span>-analysis.py<span class="w"> </span>&lt;input_json&gt;<span class="w"> </span><span class="o">[</span>output_json<span class="o">]</span><span class="w"> </span><span class="o">[</span>-saveInputs<span class="o">]</span><span class="w"> </span><span class="o">[</span>-uuid<span class="o">=</span><span class="s2">&quot;UUID&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>-flow_uuid<span class="o">=</span><span class="s2">&quot;FLOW-UUID&quot;</span><span class="o">]</span>
</code></pre></div>

<ul class="docs-list">
<li><code class="docs-inline-code">&lt;input_json&gt;</code>: (Required) Path to the input JSON file containing the analysis parameters.</li>
<li><code class="docs-inline-code">[output_json]</code>: (Optional) Path where the output JSON file should be saved. If omitted, a default path is generated based on the script name and a UUID.</li>
<li><code class="docs-inline-code">-saveInputs</code>: (Optional) Flag to save the system and user prompts sent to the LLM into the <code class="docs-inline-code">flow/&lt;flowUUID&gt;/inputs/</code> directory.</li>
<li><code class="docs-inline-code">-uuid="UUID"</code>: (Optional) Specify a custom UUID for the output file metadata.</li>
<li><code class="docs-inline-code">-flow_uuid="FLOW-UUID"</code>: (Optional) Specify the UUID for the flow, used for saving inputs if <code class="docs-inline-code">-saveInputs</code> is active.</li>
</ul>
<h2 id="input-files">Input Files<a class="headerlink" href="#input-files" title="Permanent link">&para;</a></h2>
<p>The script expects an input JSON file with the following structure:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;topic&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The specific area or process for automation ROI analysis&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gemma3&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Optional: Specify the LLM model (defaults if not provided)</span>
<span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// Optional: Additional parameters for the LLM call</span>
<span class="p">}</span>
</code></pre></div>

<ul class="docs-list">
<li><code class="docs-inline-code">topic</code>: A string describing the subject of the ROI analysis.</li>
<li><code class="docs-inline-code">model</code>: (Optional) The identifier for the LLM to use (e.g., "gemma3").</li>
<li><code class="docs-inline-code">parameters</code>: (Optional) A JSON object containing any specific parameters for the LLM interaction (handled by <code class="docs-inline-code">utils.chat_with_llm</code>).</li>
</ul>
<h2 id="key-functions">Key Functions<a class="headerlink" href="#key-functions" title="Permanent link">&para;</a></h2>
<ul class="docs-list">
<li><strong><code class="docs-inline-code">sanitize_json_string(json_str)</code></strong>: Removes invalid control characters (ASCII 0-31, excluding tab, newline, carriage return) from a string to prevent JSON parsing errors.</li>
<li><strong><code class="docs-inline-code">extract_json_from_response(response)</code></strong>: Attempts to extract and parse a valid JSON object from the LLM's raw response string. It tries:<ol class="docs-list docs-list-ordered">
<li>Direct parsing of the (sanitized) response.</li>
<li>Extracting content within JSON code fences (e.g., <code class="docs-inline-code">json ...</code>).</li>
<li>Extracting content within the first opening <code class="docs-inline-code">{</code> and last closing <code class="docs-inline-code">}</code>.
Returns the parsed JSON object or <code class="docs-inline-code">None</code> if parsing fails.</li>
</ol>
</li>
<li><strong><code class="docs-inline-code">generate_roi_analysis(input_data, save_inputs=False)</code></strong>: Orchestrates the ROI analysis generation. It extracts the <code class="docs-inline-code">topic</code>, <code class="docs-inline-code">model</code>, and <code class="docs-inline-code">parameters</code> from the input, constructs the system and user prompts, optionally saves the prompts using <code class="docs-inline-code">utils.saveToFile</code>, calls <code class="docs-inline-code">utils.chat_with_llm</code> to get the LLM response, and uses <code class="docs-inline-code">extract_json_from_response</code> to parse the result.</li>
<li><strong><code class="docs-inline-code">main()</code></strong>: The main execution function. It handles command-line arguments using <code class="docs-inline-code">utils.handle_command_args</code>, loads the input JSON using <code class="docs-inline-code">utils.load_json</code>, calls <code class="docs-inline-code">generate_roi_analysis</code>, determines the output path using <code class="docs-inline-code">utils.get_output_filepath</code>, creates metadata using <code class="docs-inline-code">utils.create_output_metadata</code>, combines metadata with the analysis results, and saves the final output using <code class="docs-inline-code">utils.save_output</code>. It exits if <code class="docs-inline-code">generate_roi_analysis</code> fails to return valid JSON data.</li>
<li><strong><code class="docs-inline-code">utils</code> Functions</strong>: Relies on helper functions from <code class="docs-inline-code">utils.py</code> for common tasks like loading JSON (<code class="docs-inline-code">load_json</code>), saving output (<code class="docs-inline-code">save_output</code>), interacting with the LLM (<code class="docs-inline-code">chat_with_llm</code>), creating metadata (<code class="docs-inline-code">create_output_metadata</code>), determining file paths (<code class="docs-inline-code">get_output_filepath</code>), handling arguments (<code class="docs-inline-code">handle_command_args</code>), and saving intermediate files (<code class="docs-inline-code">saveToFile</code>).</li>
</ul>
<h2 id="llm-interaction">LLM Interaction<a class="headerlink" href="#llm-interaction" title="Permanent link">&para;</a></h2>
<p>The script crafts specific prompts for the LLM:</p>
<ul class="docs-list">
<li><strong>System Prompt</strong>: Instructs the LLM to act as an AI assistant specialized in ROI analysis for automation, focusing on small, medium, and large production scales.</li>
<li><strong>User Prompt</strong>: Provides the specific <code class="docs-inline-code">topic</code> and explicitly requests the output in a JSON format with a defined structure:<ul class="docs-list">
<li><code class="docs-inline-code">roi_analysis</code>: An object containing keys <code class="docs-inline-code">small_scale</code>, <code class="docs-inline-code">medium_scale</code>, <code class="docs-inline-code">large_scale</code>. Each scale object must include:<ul class="docs-list">
<li><code class="docs-inline-code">timeframe</code>: Typical ROI timeframe (string).</li>
<li><code class="docs-inline-code">initial_investment</code>: Estimated investment range (string).</li>
<li><code class="docs-inline-code">annual_savings</code>: Estimated annual savings (string).</li>
<li><code class="docs-inline-code">key_considerations</code>: Array of factors affecting ROI at that scale.</li>
</ul>
</li>
<li><code class="docs-inline-code">key_benefits</code>: An array of significant benefits across all scales.</li>
<li><code class="docs-inline-code">barriers</code>: An array of common challenges to achieving ROI.</li>
<li><code class="docs-inline-code">recommendation</code>: A brief suggestion on which scale benefits most.
The prompt strongly emphasizes returning <em>only</em> the valid JSON object without any surrounding text or formatting.</li>
</ul>
</li>
<li>The interaction is performed using the <code class="docs-inline-code">utils.chat_with_llm</code> function.</li>
</ul>
<h2 id="json-handling">JSON Handling<a class="headerlink" href="#json-handling" title="Permanent link">&para;</a></h2>
<p>Robust JSON handling is crucial as LLM output can be inconsistent.
*   <code class="docs-inline-code">sanitize_json_string</code> preprocesses the LLM response to remove characters that would cause <code class="docs-inline-code">json.loads</code> to fail.
*   <code class="docs-inline-code">extract_json_from_response</code> implements a multi-stage parsing strategy:
    1.  It first tries to parse the entire sanitized response directly.
    2.  If that fails, it looks for JSON content enclosed in <code class="docs-inline-code">json ...</code> or <code class="docs-inline-code">...</code> code fences.
    3.  If still unsuccessful, it attempts to parse the content between the first <code class="docs-inline-code">{</code> and the last <code class="docs-inline-code">}</code> in the response.
This approach increases the likelihood of successfully extracting the desired JSON data even if the LLM includes extraneous text or formatting.</p>
<h2 id="output">Output<a class="headerlink" href="#output" title="Permanent link">&para;</a></h2>
<p>The script generates a JSON file containing:</p>
<ol class="docs-list docs-list-ordered">
<li><strong>Process Metadata</strong>: Information about the script execution, including the task name ("Automation ROI Analysis"), start time, and a unique UUID, generated by <code class="docs-inline-code">utils.create_output_metadata</code>.</li>
<li><strong>ROI Analysis</strong>: The <code class="docs-inline-code">roi_analysis</code> key holds the structured JSON object parsed from the LLM response, containing the detailed analysis across different scales, benefits, barriers, and the recommendation.</li>
</ol>
<p>Example Output Structure:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;process_metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;task_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Automation ROI Analysis&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;start_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YYYY-MM-DDTHH:MM:SS.ffffff&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YYYY-MM-DDTHH:MM:SS.ffffff&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;duration_seconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">15.234</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;uuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;generated-or-specified-uuid&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;roi_analysis&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;roi_analysis&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;small_scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;timeframe&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;initial_investment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;annual_savings&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;key_considerations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;medium_scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;large_scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;key_benefits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;barriers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;recommendation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>If the script cannot extract or parse valid JSON from the LLM response after trying all methods in <code class="docs-inline-code">extract_json_from_response</code>, it prints an error message and exits with a non-zero status code.</p>
                    </div>
                    
                    <footer class="docs-footer">
                        <div class="docs-meta">
                            <p>Part of the <a href="/">Universal Automation Wiki</a> documentation</p>
                        </div>
                    </footer>
                </article>
            </main>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script src="/assets/js/components.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'neutral',
            themeVariables: {
                primaryColor: '#126ca8',
                primaryTextColor: '#333',
                primaryBorderColor: '#e0e0e0',
                lineColor: '#666'
            }
        });
    </script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/documentation.js"></script>
    <script>renderDocumentationSidebar('#sidebar-placeholder');</script>
</body>
</html>