<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge Duplicate Facts - Universal Automation Wiki</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/components.css">
    <link rel="stylesheet" href="/assets/css/category.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/documentation.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600;700&family=Geologica:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Placeholder styles to prevent layout shift */
        #header-placeholder { min-height: 70px; }
        #footer-placeholder { min-height: 250px; }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="docs-container">
        <div class="docs-layout">
            <div id="sidebar-placeholder"></div>

            <main class="docs-main">
                <article class="docs-article">
                    <header class="docs-header">
                        <div class="docs-breadcrumb">
                            <nav aria-label="Breadcrumb">
                                <ol>
                                    
                                        
                                            <li><a href="/">Home</a></li>
                                        
                                    
                                        
                                            <li><a href="/docs/">Documentation</a></li>
                                        
                                    
                                        
                                            <li><a href="/docs/routines/">Routines</a></li>
                                        
                                    
                                        
                                            <li aria-current="page">Merge Duplicate Facts</li>
                                        
                                    
                                </ol>
                            </nav>
                        </div>
                        
                        <div class="docs-title-section">
                            <h1 class="docs-page-title">Merge Duplicate Facts</h1>
                            
                            <p class="docs-page-subtitle">This script utilizes a Large Language Model (LLM) to process a list of facts provided in an input JSON file. It identifies duplicate or semantically similar facts, merges them into comprehensive, unique statements, and outputs the deduplicated list along with metadata to a new JSON file.</p>
                            
                        </div>
                    </header>

                    <div class="docs-content">
                        <p>This script utilizes a Large Language Model (LLM) to process a list of facts provided in an input JSON file. It identifies duplicate or semantically similar facts, merges them into comprehensive, unique statements, and outputs the deduplicated list along with metadata to a new JSON file.</p>
<h2 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">&para;</a></h2>
<p>The primary goal of this script is to reduce redundancy in a list of factual statements by leveraging an LLM's understanding of language to consolidate similar information.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Run the script from the command line:</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>merge-duplicate-facts.py<span class="w"> </span>&lt;input_json&gt;<span class="w"> </span><span class="o">[</span>output_json<span class="o">]</span>
</code></pre></div>

<ul class="docs-list">
<li><code class="docs-inline-code">&lt;input_json&gt;</code>: (Required) Path to the input JSON file containing the facts to be processed.</li>
<li><code class="docs-inline-code">[output_json]</code>: (Optional) Path where the output JSON file should be saved. If not provided, a path will be generated automatically in the <code class="docs-inline-code">output/</code> directory based on the script name and a UUID.</li>
</ul>
<p><strong>Note:</strong> The script comments recommend using the model <code class="docs-inline-code">llama3.1:8b-instruct-q5_K_M</code> for potentially better results, although the default is <code class="docs-inline-code">gemma3</code>. This can be specified in the input JSON.</p>
<h2 id="input-files">Input Files<a class="headerlink" href="#input-files" title="Permanent link">&para;</a></h2>
<p>The script expects an input JSON file with the following structure:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;facts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;Fact statement 1.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;Fact statement 2.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;A statement similar to fact 1.&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;llama3.1:8b-instruct-q5_K_M&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Optional: Defaults to &quot;gemma3&quot; if omitted</span>
<span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// Optional: LLM parameters (e.g., temperature)</span>
<span class="p">}</span>
</code></pre></div>

<ul class="docs-list">
<li><code class="docs-inline-code">facts</code>: A list of strings, where each string is a fact to be processed.</li>
<li><code class="docs-inline-code">model</code>: (Optional) The name of the LLM model to use (e.g., from Ollama).</li>
<li><code class="docs-inline-code">parameters</code>: (Optional) A dictionary of parameters to pass to the LLM during the chat interaction.</li>
</ul>
<h2 id="key-functions">Key Functions<a class="headerlink" href="#key-functions" title="Permanent link">&para;</a></h2>
<ul class="docs-list">
<li><strong><code class="docs-inline-code">merge_duplicate_facts(input_data)</code></strong>:<ul class="docs-list">
<li>Extracts the <code class="docs-inline-code">facts</code>, <code class="docs-inline-code">model</code>, and <code class="docs-inline-code">parameters</code> from the input data.</li>
<li>Constructs system and user messages to instruct the LLM.</li>
<li>Calls <code class="docs-inline-code">chat_with_llm</code> to interact with the specified LLM.</li>
<li>Uses <code class="docs-inline-code">parse_llm_json_response</code> to attempt parsing the LLM's response into a list of strings.</li>
<li>Returns the list of merged facts or a default error message if parsing fails.</li>
</ul>
</li>
<li><strong><code class="docs-inline-code">main()</code></strong>:<ul class="docs-list">
<li>Handles command-line arguments using <code class="docs-inline-code">handle_command_args</code> to get input and optional output file paths.</li>
<li>Loads the input JSON using <code class="docs-inline-code">load_json</code>.</li>
<li>Calls <code class="docs-inline-code">merge_duplicate_facts</code> to perform the core logic.</li>
<li>Determines the output file path using <code class="docs-inline-code">get_output_filepath</code>.</li>
<li>Creates metadata (script name, timestamp, UUID) using <code class="docs-inline-code">create_output_metadata</code>.</li>
<li>Combines metadata and the <code class="docs-inline-code">merged_facts</code> into a final dictionary.</li>
<li>Saves the output data to the determined path using <code class="docs-inline-code">save_output</code>.</li>
</ul>
</li>
<li><strong><code class="docs-inline-code">utils</code> Functions</strong>: The script relies on helper functions imported from <code class="docs-inline-code">utils.py</code>:<ul class="docs-list">
<li><code class="docs-inline-code">load_json</code>: Loads data from a JSON file.</li>
<li><code class="docs-inline-code">save_output</code>: Saves data to a JSON file.</li>
<li><code class="docs-inline-code">chat_with_llm</code>: Handles the interaction with the LLM service.</li>
<li><code class="docs-inline-code">parse_llm_json_response</code>: Parses JSON content from the LLM's text response.</li>
<li><code class="docs-inline-code">create_output_metadata</code>: Generates standard metadata for output files.</li>
<li><code class="docs-inline-code">get_output_filepath</code>: Determines the appropriate output file path.</li>
<li><code class="docs-inline-code">handle_command_args</code>: Parses command-line arguments.</li>
</ul>
</li>
</ul>
<h2 id="llm-interaction">LLM Interaction<a class="headerlink" href="#llm-interaction" title="Permanent link">&para;</a></h2>
<ol class="docs-list docs-list-ordered">
<li><strong>Prompt Construction</strong>:<ul class="docs-list">
<li>A <strong>system message</strong> instructs the LLM that its role is to identify duplicate/similar facts, merge them comprehensively, organize logically, remove redundancy, and format the output as a JSON array of unique fact strings.</li>
<li>A <strong>user message</strong> presents the list of facts (prefixed with <code class="docs-inline-code">-</code>) from the input file and asks the LLM to perform the merging task.</li>
</ul>
</li>
<li><strong>LLM Call</strong>: The <code class="docs-inline-code">chat_with_llm</code> utility function sends these messages to the specified LLM (<code class="docs-inline-code">model</code> from input or default).</li>
<li><strong>Response Parsing</strong>: The script expects the LLM to return a JSON-formatted string representing an array of unique facts. The <code class="docs-inline-code">parse_llm_json_response</code> utility attempts to parse this string into a Python list.</li>
</ol>
<h2 id="output">Output<a class="headerlink" href="#output" title="Permanent link">&para;</a></h2>
<p>The script generates a JSON file containing:</p>
<ul class="docs-list">
<li><strong>Metadata</strong>: Information about the script execution, including the script name (<code class="docs-inline-code">routine_name</code>), a unique identifier (<code class="docs-inline-code">uuid</code>), and the start time (<code class="docs-inline-code">start_time_utc</code>).</li>
<li><strong><code class="docs-inline-code">merged_facts</code></strong>: A list of strings, where each string is a unique, potentially merged fact as returned and parsed from the LLM. If the LLM response cannot be parsed into a valid list, this will contain a single string: <code class="docs-inline-code">["No valid facts could be merged"]</code>.</li>
</ul>
<p>Example Output Structure:</p>
<p>```json
{
  "metadata": {
    "routine_name": "Merge Duplicate Facts",
    "uuid": "...",
    "start_time_utc": "..."
  },
  "merged_facts": [
    "Merged fact statement 1.",
    "Unique fact statement 2."
  ]
}</p>
                    </div>
                    
                    <footer class="docs-footer">
                        <div class="docs-meta">
                            <p>Part of the <a href="/">Universal Automation Wiki</a> documentation</p>
                        </div>
                    </footer>
                </article>
            </main>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script src="/assets/js/components.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'neutral',
            themeVariables: {
                primaryColor: '#126ca8',
                primaryTextColor: '#333',
                primaryBorderColor: '#e0e0e0',
                lineColor: '#666'
            }
        });
    </script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/documentation.js"></script>
    <script>renderDocumentationSidebar('#sidebar-placeholder');</script>
</body>
</html>