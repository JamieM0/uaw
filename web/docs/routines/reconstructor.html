<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-65XT8ZJM5X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-65XT8ZJM5X');
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Reconstruction - Universal Automation Wiki</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/components.css">
    <link rel="stylesheet" href="/assets/css/category.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/documentation.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600;700&family=Geologica:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Placeholder styles to prevent layout shift */
        #header-placeholder { min-height: 70px; }
        #footer-placeholder { min-height: 250px; }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="docs-container">
        <div class="docs-layout">
            <div id="sidebar-placeholder"></div>

            <main class="docs-main">
                <article class="docs-article">
                    <header class="docs-header">
                        <div class="docs-breadcrumb">
                            <nav aria-label="Breadcrumb">
                                <ol>
                                    
                                        
                                            <li><a href="/">Home</a></li>
                                        
                                    
                                        
                                            <li><a href="/docs/">Documentation</a></li>
                                        
                                    
                                        
                                            <li><a href="/docs/routines/">Routines</a></li>
                                        
                                    
                                        
                                            <li aria-current="page">Tree Reconstruction</li>
                                        
                                    
                                </ol>
                            </nav>
                        </div>
                        
                        <div class="docs-title-section">
                            <h1 class="docs-page-title">Tree Reconstruction</h1>
                            
                            <p class="docs-page-subtitle">This script reconstructs the hierarchical path (branch) from the root node to a specified target node within a filesystem-based tree structure. It identifies nodes using UUIDs stored in `node.json` files and traces parent-child relationships to build the branch representation.</p>
                            
                        </div>
                    </header>

                    <div class="docs-content">
                        <p>This script reconstructs the hierarchical path (branch) from the root node to a specified target node within a filesystem-based tree structure. It identifies nodes using UUIDs stored in <code class="docs-inline-code">node.json</code> files and traces parent-child relationships to build the branch representation.</p>
<h2 class="docs-heading" id="purpose">Purpose<a class="headerlink" href="#purpose" title="Link to this section">¶</a></h2>
<p>The primary purpose of <code class="docs-inline-code">reconstructor.py</code> is to extract and visualize a specific lineage within a larger, potentially complex tree structure stored across directories and JSON files. Given a target node’s UUID, it finds the node and traces its ancestry back to the root, outputting this specific branch as a structured JSON object.</p>
<h2 class="docs-heading" id="usage">Usage<a class="headerlink" href="#usage" title="Link to this section">¶</a></h2>
<p>Run the script from the command line:</p>
<div class="codehilite"><pre><span></span><code class="language-text">python<span class="w"> </span>reconstructor.py<span class="w"> </span>&lt;node_uuid&gt;<span class="w"> </span><span class="o">[</span>search_directory<span class="o">]</span><span class="w"> </span><span class="o">[</span>output_json<span class="o">]</span>
</code></pre></div>
<ul class="docs-list">
<li><code class="docs-inline-code">&lt;node_uuid&gt;</code>: (Required) The unique identifier (UUID) of the target node from which to reconstruct the tree branch.</li>
<li><code class="docs-inline-code">[search_directory]</code>: (Optional) The directory where the script should search recursively for <code class="docs-inline-code">node.json</code> files. Defaults to <code class="docs-inline-code">output/</code> if not specified.</li>
<li><code class="docs-inline-code">[output_json]</code>: (Optional) The file path where the resulting JSON output should be saved. If omitted, a path is automatically generated within the <code class="docs-inline-code">output/reconstructor/</code> directory using a timestamp and a new UUID.</li>
</ul>
<p><strong>Examples:</strong></p>
<div class="codehilite"><pre><span></span><code class="language-text"><span class="c1"># Reconstruct from UUID, search in default 'output/' directory</span>
python<span class="w"> </span>reconstructor.py<span class="w"> </span>e2dd9b38ab194156

<span class="c1"># Reconstruct from UUID, search in a specific directory</span>
python<span class="w"> </span>reconstructor.py<span class="w"> </span>e2dd9b38ab194156<span class="w"> </span>output/hallucinate-tree

<span class="c1"># Reconstruct, search in specific directory, and save to a specific file</span>
python<span class="w"> </span>reconstructor.py<span class="w"> </span>e2dd9b38ab194156<span class="w"> </span>output/hallucinate-tree<span class="w"> </span>my_tree.json
</code></pre></div>
<h2 class="docs-heading" id="input-filesystem">Input (Filesystem)<a class="headerlink" href="#input-filesystem" title="Link to this section">¶</a></h2>
<p>The script expects a directory structure, typically generated by other scripts like <code class="docs-inline-code">hallucinate-tree.py</code> or <code class="docs-inline-code">expand-node.py</code>. This structure consists of:</p>
<ul class="docs-list">
<li>A base search directory (e.g., <code class="docs-inline-code">output/</code>).</li>
<li>Nested subdirectories, where each directory potentially represents a node in the tree.</li>
<li><code class="docs-inline-code">node.json</code> files within these directories. Each <code class="docs-inline-code">node.json</code> file should contain at least:<ul class="docs-list">
<li><code class="docs-inline-code">"uuid"</code>: A unique string identifier for the node.</li>
<li><code class="docs-inline-code">"step"</code>: A string describing the node or step it represents.</li>
</ul>
</li>
<li>For nodes that are not the root of the tree, the <code class="docs-inline-code">node.json</code> file must also contain:<ul class="docs-list">
<li><code class="docs-inline-code">"parent_uuid"</code>: The UUID of the parent node, linking it in the hierarchy.</li>
</ul>
</li>
</ul>
<h2 class="docs-heading" id="key-functions">Key Functions<a class="headerlink" href="#key-functions" title="Link to this section">¶</a></h2>
<ul class="docs-list">
<li><code class="docs-inline-code">find_node_by_uuid(search_uuid, base_dir)</code>: Recursively walks the <code class="docs-inline-code">base_dir</code>, opens <code class="docs-inline-code">node.json</code> files, and returns the parsed data of the node matching the <code class="docs-inline-code">search_uuid</code>.</li>
<li><code class="docs-inline-code">get_parent_chain(node_data, search_dir)</code>: Starts with the target <code class="docs-inline-code">node_data</code> and iteratively uses <code class="docs-inline-code">find_node_by_uuid</code> to find the parent node based on <code class="docs-inline-code">parent_uuid</code>. It continues this process until it reaches a node without a <code class="docs-inline-code">parent_uuid</code> (the root). Returns an ordered list of node data dictionaries representing the path from the root to the target node.</li>
<li><code class="docs-inline-code">build_tree_branch(node_chain)</code>: Takes the ordered list from <code class="docs-inline-code">get_parent_chain</code> and constructs a nested dictionary structure that mirrors the hierarchical branch. Each level contains the <code class="docs-inline-code">step</code> and <code class="docs-inline-code">uuid</code> of a node and a <code class="docs-inline-code">children</code> list (which, in this reconstructed branch, will contain at most one child).</li>
<li><code class="docs-inline-code">parse_command_args()</code>: Parses command-line arguments (<code class="docs-inline-code">sys.argv</code>) to extract the <code class="docs-inline-code">node_uuid</code>, <code class="docs-inline-code">search_directory</code>, and <code class="docs-inline-code">output_json</code> path, handling optional arguments and defaults.</li>
<li><code class="docs-inline-code">main()</code>: The main execution function. It coordinates the process: calls <code class="docs-inline-code">parse_command_args</code>, sets defaults, calls <code class="docs-inline-code">find_node_by_uuid</code>, <code class="docs-inline-code">get_parent_chain</code>, and <code class="docs-inline-code">build_tree_branch</code>, generates metadata using <code class="docs-inline-code">utils.create_output_metadata</code>, prepares the final output dictionary, determines the output file path using <code class="docs-inline-code">utils.get_output_filepath</code>, and saves the result using <code class="docs-inline-code">utils.save_output</code>.</li>
<li><code class="docs-inline-code">utils</code> functions: Relies on helper functions from <code class="docs-inline-code">utils.py</code> for saving output (<code class="docs-inline-code">save_output</code>), creating standard metadata (<code class="docs-inline-code">create_output_metadata</code>), and determining the output file path (<code class="docs-inline-code">get_output_filepath</code>).</li>
</ul>
<h2 class="docs-heading" id="reconstruction-logic">Reconstruction Logic<a class="headerlink" href="#reconstruction-logic" title="Link to this section">¶</a></h2>
<ol class="docs-list docs-list-ordered">
<li><strong>Find Target Node:</strong> The script starts by searching the specified <code class="docs-inline-code">search_directory</code> (or <code class="docs-inline-code">output/</code> by default) recursively for a <code class="docs-inline-code">node.json</code> file whose <code class="docs-inline-code">uuid</code> matches the provided <code class="docs-inline-code">&lt;node_uuid&gt;</code>. This is done by the <code class="docs-inline-code">find_node_by_uuid</code> function.</li>
<li><strong>Trace Ancestry:</strong> Once the target node is found, the <code class="docs-inline-code">get_parent_chain</code> function takes its data. It looks for the <code class="docs-inline-code">parent_uuid</code> field and calls <code class="docs-inline-code">find_node_by_uuid</code> again to locate the parent node’s data. This process repeats, moving up the hierarchy using <code class="docs-inline-code">parent_uuid</code> links, until a node without a <code class="docs-inline-code">parent_uuid</code> is encountered (this is considered the root of the branch). This results in an ordered list of all nodes from the root down to the target node.</li>
<li><strong>Build Branch Structure:</strong> The <code class="docs-inline-code">build_tree_branch</code> function takes the ordered list of nodes. It creates a nested dictionary structure where each node from the list becomes a level in the dictionary. The root node forms the base, and subsequent nodes are added as children to the previous node, effectively recreating the specific branch’s hierarchy.</li>
</ol>
<h2 class="docs-heading" id="output">Output<a class="headerlink" href="#output" title="Link to this section">¶</a></h2>
<p>The script generates a JSON file containing the reconstructed tree branch and associated metadata. The structure of the JSON output is:</p>
<div class="codehilite"><pre><span></span><code class="language-text"><span class="p">{</span>
<span class="w">  </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="c1">// UUID generated for this reconstruction process</span>
<span class="w">  </span><span class="nt">"task"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tree Reconstruction"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Name of the task</span>
<span class="w">  </span><span class="nt">"date_created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="c1">// Timestamp of creation</span>
<span class="w">  </span><span class="nt">"time_taken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="c1">// Time elapsed for the script execution</span>
<span class="w">  </span><span class="nt">"source_uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="c1">// The target node UUID provided as input</span>
<span class="w">  </span><span class="nt">"search_directory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="c1">// The directory searched for nodes</span>
<span class="w">  </span><span class="nt">"path_length"</span><span class="p">:</span><span class="w"> </span><span class="err">N</span><span class="p">,</span><span class="w"> </span><span class="c1">// Integer: Number of nodes in the reconstructed branch</span>
<span class="w">  </span><span class="nt">"reconstructed_tree"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Nested dictionary representing the branch</span>
<span class="w">    </span><span class="nt">"step"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Root Node Step"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"root-node-uuid"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"children"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"step"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Child Node Step"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"child-node-uuid"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"children"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="c1">// ... further nested nodes down to the target node</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"step"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Target Node Step"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"target-node-uuid"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"children"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The <code class="docs-inline-code">reconstructed_tree</code> provides a clear, hierarchical view of the path from the root node down to the specific node identified by the <code class="docs-inline-code">source_uuid</code>.</p>
                    </div>
                    
                    <footer class="docs-footer">
                        <div class="docs-meta">
                            <p>Part of the <a href="/">Universal Automation Wiki</a> documentation</p>
                        </div>
                    </footer>
                </article>
            </main>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script src="/assets/js/components.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'neutral',
            themeVariables: {
                primaryColor: '#126ca8',
                primaryTextColor: '#333',
                primaryBorderColor: '#e0e0e0',
                lineColor: '#666'
            }
        });
    </script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/documentation.js"></script>
    <script>renderDocumentationSidebar('#sidebar-placeholder');</script>
</body>
</html>