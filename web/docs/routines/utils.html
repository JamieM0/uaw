<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-65XT8ZJM5X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-65XT8ZJM5X');
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utility Functions - Universal Automation Wiki</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/components.css">
    <link rel="stylesheet" href="/assets/css/category.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/documentation.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600;700&family=Geologica:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Placeholder styles to prevent layout shift */
        #header-placeholder { min-height: 70px; }
        #footer-placeholder { min-height: 250px; }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="docs-container">
        <div class="docs-layout">
            <div id="sidebar-placeholder"></div>

            <main class="docs-main">
                <article class="docs-article">
                    <header class="docs-header">
                        <div class="docs-breadcrumb">
                            <nav aria-label="Breadcrumb">
                                <ol>
                                    
                                        
                                            <li><a href="/">Home</a></li>
                                        
                                    
                                        
                                            <li><a href="/docs/">Documentation</a></li>
                                        
                                    
                                        
                                            <li><a href="/docs/routines/">Routines</a></li>
                                        
                                    
                                        
                                            <li aria-current="page">Utility Functions</li>
                                        
                                    
                                </ol>
                            </nav>
                        </div>
                        
                        <div class="docs-title-section">
                            <h1 class="docs-page-title">Utility Functions</h1>
                            
                            <p class="docs-page-subtitle">This script provides a collection of common helper functions used by various automation and processing scripts within the project. It includes functions for file I/O, JSON handling, interacting with Large Language Models (LLMs) via Ollama, processing LLM responses, managing command-line arguments, and generating metadata.</p>
                            
                        </div>
                    </header>

                    <div class="docs-content">
                        <p>This script provides a collection of common helper functions used by various automation and processing scripts within the project. It includes functions for file I/O, JSON handling, interacting with Large Language Models (LLMs) via Ollama, processing LLM responses, managing command-line arguments, and generating metadata.</p>
<h2 class="docs-heading" id="load_json">load_json<a class="headerlink" href="#load_json" title="Link to this section">¶</a></h2>
<p>Loads data from a specified JSON file.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Reads a JSON file from the given <code class="docs-inline-code">filepath</code> and returns the parsed Python object (typically a dictionary or list).</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">data = load_json("path/to/input.json")</code></li>
</ul>
<h2 class="docs-heading" id="save_output">save_output<a class="headerlink" href="#save_output" title="Link to this section">¶</a></h2>
<p>Saves Python data structures to a JSON file.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Writes the provided <code class="docs-inline-code">output_data</code> to the specified <code class="docs-inline-code">output_filepath</code> in JSON format with indentation. It automatically creates the necessary output directory if it doesn’t exist.</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">save_output(my_data, "output/results.json")</code></li>
</ul>
<h2 class="docs-heading" id="parse_embedded_json">parse_embedded_json<a class="headerlink" href="#parse_embedded_json" title="Link to this section">¶</a></h2>
<p>Recursively parses JSON strings embedded within node structures.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Checks if the <code class="docs-inline-code">step</code> field of a dictionary (node) contains a string that looks like a JSON array or object. If it does, it parses the JSON and replaces the node’s <code class="docs-inline-code">children</code> field with the parsed content. This is useful for handling nested structures generated by LLMs where steps might contain further sub-steps defined as JSON. If the node doesn’t have a <code class="docs-inline-code">title</code>, the original <code class="docs-inline-code">step</code> string is used as the title after parsing.</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">processed_node = parse_embedded_json(node_with_potential_json_step)</code></li>
</ul>
<h2 class="docs-heading" id="chat_with_llm">chat_with_llm<a class="headerlink" href="#chat_with_llm" title="Link to this section">¶</a></h2>
<p>Interacts with a specified Ollama LLM.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Provides a generic interface to send a system message and a user message to an LLM (specified by <code class="docs-inline-code">model</code>) using the <code class="docs-inline-code">ollama</code> library. It accepts optional <code class="docs-inline-code">parameters</code> for the Ollama API call.</li>
<li><strong>Returns:</strong> The content of the LLM’s response as a cleaned string.</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">response = chat_with_llm("gemma3", "System prompt", "User query", {"temperature": 0.7})</code></li>
</ul>
<h2 class="docs-heading" id="clean_llm_json_response">clean_llm_json_response<a class="headerlink" href="#clean_llm_json_response" title="Link to this section">¶</a></h2>
<p>Cleans up potential JSON responses from an LLM.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Attempts to extract a valid JSON object or array from a raw LLM response string. It removes common artifacts like Markdown code fences (<code class="docs-inline-code">```json</code>, <code class="docs-inline-code">```</code>).</li>
<li><strong>Returns:</strong> The extracted JSON string if found, otherwise the cleaned-up text.</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">json_string = clean_llm_json_response(raw_llm_output)</code></li>
</ul>
<h2 class="docs-heading" id="parse_llm_json_response">parse_llm_json_response<a class="headerlink" href="#parse_llm_json_response" title="Link to this section">¶</a></h2>
<p>Parses JSON from an LLM response with fallback handling.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Takes raw LLM response text, cleans it using <code class="docs-inline-code">clean_llm_json_response</code>, and attempts to parse it as JSON.</li>
<li><strong>Fallback:</strong> If JSON parsing fails, it splits the cleaned text by lines and returns a list of dictionaries.<ul class="docs-list">
<li>If <code class="docs-inline-code">include_children</code> is <code class="docs-inline-code">True</code>, each dictionary will have the structure <code class="docs-inline-code">{"step": "line content", "children": []}</code>.</li>
<li>If <code class="docs-inline-code">include_children</code> is <code class="docs-inline-code">False</code> (default), each dictionary will have the structure <code class="docs-inline-code">{"step": "line content"}</code>.</li>
</ul>
</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">parsed_data = parse_llm_json_response(raw_llm_output, include_children=True)</code></li>
</ul>
<h2 class="docs-heading" id="create_output_metadata">create_output_metadata<a class="headerlink" href="#create_output_metadata" title="Link to this section">¶</a></h2>
<p>Generates standard metadata for output files.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Creates a dictionary containing common metadata associated with a task’s output, including a UUID (<code class="docs-inline-code">output_uuid</code>), creation timestamp, the <code class="docs-inline-code">task_name</code>, and the time taken (calculated from the <code class="docs-inline-code">start_time</code>).</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">metadata = create_output_metadata("Data Processing", start_timestamp, generated_uuid)</code></li>
</ul>
<h2 class="docs-heading" id="get_output_filepath">get_output_filepath<a class="headerlink" href="#get_output_filepath" title="Link to this section">¶</a></h2>
<p>Determines the final path for an output file.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Returns the appropriate file path for saving output. If <code class="docs-inline-code">specified_path</code> is provided, it’s used directly. Otherwise, it constructs a path within the <code class="docs-inline-code">output/{output_dir}</code> directory using a provided or newly generated <code class="docs-inline-code">output_uuid</code>. It ensures the output directory exists.</li>
<li><strong>Returns:</strong> A tuple containing the determined filepath and the UUID used.</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">filepath, uuid = get_output_filepath("processed_data", output_uuid=my_uuid)</code> or <code class="docs-inline-code">filepath, uuid = get_output_filepath("results", specified_path="custom/output/final.json")</code></li>
</ul>
<h2 class="docs-heading" id="handle_command_args">handle_command_args<a class="headerlink" href="#handle_command_args" title="Link to this section">¶</a></h2>
<p>Parses and validates common command-line arguments.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Processes <code class="docs-inline-code">sys.argv</code> to extract input/output file paths and common flags like <code class="docs-inline-code">-saveInputs</code> (for debugging prompts), <code class="docs-inline-code">-uuid=&lt;value&gt;</code> (to specify an output UUID), and <code class="docs-inline-code">-flow_uuid=&lt;value&gt;</code>. It validates the number of positional arguments against <code class="docs-inline-code">min_args</code> and <code class="docs-inline-code">max_args</code>.</li>
<li><strong>Returns:</strong> A tuple containing <code class="docs-inline-code">input_filepath</code>, <code class="docs-inline-code">output_filepath</code>, <code class="docs-inline-code">save_inputs</code> (boolean), <code class="docs-inline-code">custom_uuid</code>, and <code class="docs-inline-code">flow_uuid</code>.</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">input_path, output_path, save_flag, uuid, flow_id = handle_command_args("Usage: script.py &lt;input&gt; [output]", min_args=1, max_args=2)</code></li>
</ul>
<h2 class="docs-heading" id="savetofile">saveToFile<a class="headerlink" href="#savetofile" title="Link to this section">¶</a></h2>
<p>Saves LLM prompts to a file for debugging.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Used specifically when the <code class="docs-inline-code">-saveInputs</code> flag is detected by <code class="docs-inline-code">handle_command_args</code>. It saves the <code class="docs-inline-code">system_message</code> and <code class="docs-inline-code">user_message</code> sent to the LLM, along with a timestamp, into a specified JSON <code class="docs-inline-code">filepath</code>.</li>
<li><strong>Usage:</strong> Typically called internally after parsing arguments if <code class="docs-inline-code">save_inputs</code> is true. <code class="docs-inline-code">saveToFile(system_prompt, user_prompt, "debug/prompts/prompt_abc.json")</code></li>
</ul>
<h2 class="docs-heading" id="translate_to_basic_english">translate_to_basic_english<a class="headerlink" href="#translate_to_basic_english" title="Link to this section">¶</a></h2>
<p>Translates text into simple Basic English using an LLM.</p>
<ul class="docs-list">
<li><strong>Purpose:</strong> Takes input <code class="docs-inline-code">text</code> and uses the <code class="docs-inline-code">chat_with_llm</code> function to request a translation into very short, simple Basic English (using the 850-word list). The output is cleaned and truncated to be suitable for use as a file or folder name.</li>
<li><strong>Usage:</strong> <code class="docs-inline-code">folder_name_part = translate_to_basic_english("Complex technical description")</code></li>
</ul>
                    </div>
                    
                    <footer class="docs-footer">
                        <div class="docs-meta">
                            <p>Part of the <a href="/">Universal Automation Wiki</a> documentation</p>
                        </div>
                    </footer>
                </article>
            </main>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script src="/assets/js/components.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'neutral',
            themeVariables: {
                primaryColor: '#126ca8',
                primaryTextColor: '#333',
                primaryBorderColor: '#e0e0e0',
                lineColor: '#666'
            }
        });
    </script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/documentation.js"></script>
    <script>renderDocumentationSidebar('#sidebar-placeholder');</script>
</body>
</html>