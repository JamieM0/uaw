<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - Universal Automation Wiki</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/components.css">
    <link rel="stylesheet" href="/assets/css/category.css"> <!-- For nav cards -->
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/documentation.css"> <!-- Added documentation styles -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600;700&family=Geologica:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Placeholder styles to prevent layout shift */
        #header-placeholder { min-height: 70px; }
        #footer-placeholder { min-height: 250px; }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="docs-layout">
        <div id="sidebar-placeholder"></div>

        <main>
            <section class="hero">
                <div class="container">
                    <h1>Playground Save/Load System Documentation</h1>
                    <p class="hero-subtitle">The Universal Automation Wiki playground includes a comprehensive save/load system that allows users to save their simulations to a remote server and retrieve them later using unique 16-character save codes. This system is designed to be non-destructive, secure, and scalable.</p>
                </div>
            </section>
            <div class="spacer"></div>
            <section class="content-section">
                <div class="spacer"></div>

                <p>The Universal Automation Wiki playground includes a comprehensive save/load system that allows users to save their simulations to a remote server and retrieve them later using unique 16-character save codes. This system is designed to be non-destructive, secure, and scalable.</p>
<h2>System Overview</h2>
<img src="/assets/images/docs/save-load-architecture.png" alt="Playground Save/Load System Architecture Diagram" style="max-width:100%;height:auto;">
<p>The save/load system consists of three main components:</p>
<ol>
<li><strong>Frontend (Static Site)</strong>: JavaScript-based UI running in the user's browser</li>
<li><strong>API Server</strong>: Node.js server running on Oracle Cloud Infrastructure  </li>
<li><strong>Storage Backend</strong>: Private GitHub repository for persistent data storage</li>
</ol>
<h3>Key Design Principles</h3>
<ul>
<li><strong>Non-destructive</strong>: Every save creates a new entry, never overwrites existing data</li>
<li><strong>Privacy-focused</strong>: Strong user consent process with clear warnings</li>
<li><strong>Lineage tracking</strong>: Maintains history of simulation modifications for future diff features</li>
<li><strong>Security through obscurity</strong>: 16-character alphanumeric save codes provide reasonable protection</li>
<li><strong>Static-site compatible</strong>: Uses external API to enable smart features on GitHub Pages</li>
</ul>
<h2>Frontend Implementation</h2>
<h3>User Interface Components</h3>
<p>The playground includes two primary buttons in the top menu bar:</p>
<ul>
<li><strong>Save Simulation</strong>: Opens save modal with privacy warnings and generates save codes</li>
<li><strong>Load Simulation</strong>: Opens load modal for entering existing save codes</li>
</ul>
<h3>Save Modal Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;save-modal&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;dialog-overlay&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;dialog&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Save Simulation<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>

        <span class="cm">&lt;!-- Privacy Warning (shown on first use only) --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;save-warning&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>⚠️ Privacy Notice<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your simulation is currently private and locally stored in your browser. 
               By continuing, you agree that your simulation will be stored on a server 
               so it can later be retrieved. Do not store confidential information in 
               simulations, as anyone who guesses your save code will be able to see 
               your simulation in full.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;privacy-consent-checkbox&quot;</span><span class="p">&gt;</span>
                I understand and agree to the privacy terms above
            <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="cm">&lt;!-- Success State --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;save-success&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;save-success&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>✅ Save Successful!<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your save code is:<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;save-code-display&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;save-code-result&quot;</span> <span class="na">readonly</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;copy-save-code-btn&quot;</span><span class="p">&gt;</span>Copy<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="cm">&lt;!-- Loading State --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;save-loading&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;save-loading&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;spinner&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            Saving simulation...
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;dialog-buttons&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-secondary&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;save-cancel-btn&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-primary&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;save-confirm-btn&quot;</span><span class="p">&gt;</span>Save Simulation<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<h3>Load Modal Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;load-modal&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;dialog-overlay&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;dialog&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Load Simulation<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Enter your 16-character save code to load a previously saved simulation:<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;load-input-container&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;load-code-input&quot;</span> 
                   <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Enter save code...&quot;</span> 
                   <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;16&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="cm">&lt;!-- Error Display --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;load-error&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;load-error&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Error:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;load-error-message&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="cm">&lt;!-- Loading State --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;load-loading&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;load-loading&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;spinner&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            Loading simulation...
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;dialog-buttons&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-secondary&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;load-cancel-btn&quot;</span><span class="p">&gt;</span>Cancel<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-primary&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;load-confirm-btn&quot;</span><span class="p">&gt;</span>Load Simulation<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<h3>JavaScript State Management</h3>
<p>The frontend maintains several key state variables:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Tracks the save code of a loaded simulation (for lineage)</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">loadedSaveCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="c1">// Tracks if user has seen disclaimer this session</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">hasShownDisclaimer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</code></pre></div>

<h4>LocalStorage Usage</h4>
<p>The system uses browser LocalStorage to persist user preferences:</p>
<ul>
<li><code>uaw_playground_disclaimer_accepted</code>: Boolean indicating if user has accepted privacy terms</li>
<li>Persists across browser sessions to avoid repeatedly showing disclaimer</li>
</ul>
<h4>Event Listener Setup</h4>
<p>Event listeners are attached during the playground initialization phase to ensure DOM elements exist:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">setupSaveLoadButtons</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;INIT: Setting up save/load buttons.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">saveBtn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;save-simulation-btn&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">loadBtn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;load-simulation-btn&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">saveBtn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">saveBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">openSaveDialog</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;INIT: Save button event listener attached.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loadBtn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">loadBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">openLoadDialog</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;INIT: Load button event listener attached.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3>Save Flow Logic</h3>
<ol>
<li><strong>User clicks "Save Simulation"</strong></li>
<li><strong>Privacy check</strong>: System checks if user has previously accepted disclaimer</li>
<li>If not accepted: Show privacy warning and require checkbox consent</li>
<li>If accepted: Skip directly to save process</li>
<li><strong>JSON validation</strong>: Validate current editor content is valid JSON</li>
<li><strong>API call</strong>: Send simulation data to server with potential lineage information</li>
<li><strong>Success handling</strong>: Display save code and update session state</li>
<li><strong>Error handling</strong>: Show user-friendly error messages for failures</li>
</ol>
<h4>Save Function Implementation</h4>
<div class="codehilite"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">saveSimulation</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">previousSaveCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">API_BASE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;https://api.universalautomation.wiki&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;create&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Always create new entries</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<span class="w">        </span><span class="nx">previousSaveCode</span><span class="o">:</span><span class="w"> </span><span class="nx">previousSaveCode</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">undefined</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">API_BASE</span><span class="si">}</span><span class="sb">/playground/save`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<h3>Load Flow Logic</h3>
<ol>
<li><strong>User clicks "Load Simulation"</strong></li>
<li><strong>Code input</strong>: Modal opens with input field for 16-character save code</li>
<li><strong>Input validation</strong>: Auto-format to uppercase, alphanumeric only, 16 characters max</li>
<li><strong>API call</strong>: Retrieve simulation data from server</li>
<li><strong>Editor update</strong>: Load JSON data into Monaco editor</li>
<li><strong>Lineage tracking</strong>: Store loaded save code for future saves</li>
<li><strong>Success notification</strong>: Brief notification confirming load success</li>
</ol>
<h4>Load Function Implementation</h4>
<div class="codehilite"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">loadSimulation</span><span class="p">(</span><span class="nx">saveCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">API_BASE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;https://api.universalautomation.wiki&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">API_BASE</span><span class="si">}</span><span class="sb">/playground/load`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="nx">saveCode</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<h2>Backend API Server</h2>
<h3>Server Architecture</h3>
<p>The API server is built with Node.js and Express, running on Oracle Cloud Infrastructure. It serves as a bridge between the static frontend and the GitHub storage backend.</p>
<p><strong>Domain</strong>: <code>api.universalautomation.wiki</code>  </p>
<h3>Apache Virtual Host Configuration</h3>
<p>The server runs behind Apache as a reverse proxy:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">*:443</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nb">ServerName</span><span class="w"> </span>api.universalautomation.wiki

<span class="w">    </span><span class="c"># Proxy API requests to Node.js server</span>
<span class="w">    </span><span class="nb">ProxyPreserveHost</span><span class="w"> </span><span class="k">On</span>
<span class="w">    </span><span class="nb">ProxyRequests</span><span class="w"> </span><span class="k">Off</span>

<span class="w">    </span><span class="c"># API endpoints</span>
<span class="w">    </span><span class="nb">ProxyPass</span><span class="w"> </span><span class="sx">/playground/</span><span class="w"> </span>http://localhost:3001/playground/
<span class="w">    </span><span class="nb">ProxyPassReverse</span><span class="w"> </span><span class="sx">/playground/</span><span class="w"> </span>http://localhost:3001/playground/

<span class="w">    </span><span class="c"># Health check</span>
<span class="w">    </span><span class="nb">ProxyPass</span><span class="w"> </span><span class="sx">/health</span><span class="w"> </span>http://localhost:3001/health
<span class="w">    </span><span class="nb">ProxyPassReverse</span><span class="w"> </span><span class="sx">/health</span><span class="w"> </span>http://localhost:3001/health

<span class="w">    </span><span class="c"># CORS headers</span>
<span class="w">    </span><span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>Access-Control-Allow-Origin<span class="w"> </span><span class="s2">&quot;*&quot;</span>
<span class="w">    </span><span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>Access-Control-Allow-Methods<span class="w"> </span><span class="s2">&quot;GET, POST, OPTIONS&quot;</span>
<span class="w">    </span><span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>Access-Control-Allow-Headers<span class="w"> </span><span class="s2">&quot;Content-Type, Authorization&quot;</span>

<span class="w">    </span><span class="c"># SSL Configuration</span>
<span class="w">    </span><span class="nb">SSLEngine</span><span class="w"> </span><span class="k">on</span>
<span class="w">    </span><span class="nb">SSLCertificateFile</span><span class="w"> </span><span class="sx">/etc/letsencrypt/live/api.universalautomation.wiki/fullchain.pem</span>
<span class="w">    </span><span class="nb">SSLCertificateKeyFile</span><span class="w"> </span><span class="sx">/etc/letsencrypt/live/api.universalautomation.wiki/privkey.pem</span>
<span class="w">    </span><span class="nb">Include</span><span class="w"> </span><span class="sx">/etc/letsencrypt/options-ssl-apache.conf</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</code></pre></div>

<h3>API Endpoints</h3>
<h4>POST /playground/save</h4>
<p>Saves a simulation and returns a unique save code.</p>
<p><strong>Request Body</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;create&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;simulation\&quot;: {...}}&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;previousSaveCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ABC123DEF456GHI7&quot;</span><span class="w"> </span><span class="c1">// optional, for lineage tracking</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Response</strong> (Success):</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;saveCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;XYZ789UVW123STU4&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Simulation saved successfully&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Response</strong> (Error):</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Invalid JSON data&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4>POST /playground/load</h4>
<p>Retrieves a simulation by save code.</p>
<p><strong>Request Body</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;saveCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;XYZ789UVW123STU4&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Response</strong> (Success):</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;simulation\&quot;: {...}}&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Simulation loaded successfully&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Response</strong> (Error):</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Save code not found&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4>GET /health</h4>
<p>Health check endpoint for monitoring.</p>
<p><strong>Response</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-08-23T18:30:00.000Z&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h3>Save Code Generation</h3>
<p>Save codes are 16-character alphanumeric strings using uppercase letters and digits:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">generateSaveCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">chars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">16</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">chars</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">chars</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Characteristics</strong>:
- 36^16 possible combinations (approximately 5 × 10^24)
- Collision detection with retry logic
- URL-safe and easy to communicate
- No ambiguous characters (no lowercase, no special symbols)</p>
<h3>GitHub Integration</h3>
<p>The server uses the GitHub REST API to store simulations as JSON files in a private repository.</p>
<h2>Storage Backend (GitHub Repository)</h2>
<h3>Repository Structure</h3>
<div class="codehilite"><pre><span></span><code>uaw-playground-saves/                    # Private GitHub repository
├── README.md                           # Repository description
└── playground-saves/                   # Simulation storage directory
    ├── README.md                       # Directory documentation
    ├── ABC123DEF456GHI78.json         # Simulation file
    ├── XYZ789UVW123STU456.json        # Simulation file
    └── ... (more simulation files)
</code></pre></div>

<h3>File Format and Metadata</h3>
<p>Each saved simulation is stored as a JSON file with comprehensive metadata:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;saveCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ABC123DEF456GHI78&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;previousSaveCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;XYZ789UVW123STU456&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;savedAt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-08-23T18:30:00.000Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;simulation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sim_breadmaking_v3_full&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;article_title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Artisan Bread Making Process&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;domain&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bakery Operations&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;time_unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;minute&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;start_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;06:00&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;end_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;18:00&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;layout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;units&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;meters&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;locations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;timeline&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;actors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
<span class="w">                </span><span class="nt">&quot;tasks&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
<span class="w">                </span><span class="nt">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4>Metadata Fields</h4>
<ul>
<li><strong>saveCode</strong>: The unique 16-character identifier for this simulation</li>
<li><strong>previousSaveCode</strong>: The save code of the parent simulation (null for new simulations)</li>
<li><strong>savedAt</strong>: ISO 8601 timestamp of when the simulation was saved</li>
<li><strong>data</strong>: The actual simulation JSON object as created by the user</li>
</ul>
<h3>Commit Messages</h3>
<p>The system generates descriptive commit messages that indicate lineage:</p>
<ul>
<li><strong>New simulation</strong>: <code>Save simulation ABC123DEF456GHI78 (new)</code></li>
<li><strong>Derived simulation</strong>: <code>Save simulation XYZ789UVW123STU456 (derived from ABC123DEF456GHI78)</code></li>
</ul>
<h3>Lineage Tracking for Future Features</h3>
<p>The <code>previousSaveCode</code> field enables powerful future features:</p>
<ol>
<li><strong>Diff Visualization</strong>: Compare current simulation with its parent</li>
<li><strong>Version History</strong>: Show the complete evolution of a simulation</li>
<li><strong>Branching Analysis</strong>: Identify popular starting points for new simulations</li>
<li><strong>Collaboration Features</strong>: Multiple users building on the same base simulation</li>
</ol>
<h2>Security Considerations</h2>
<ul>
<li><strong>Clear Warnings</strong>: Prominent privacy notice explains data storage implications</li>
<li><strong>User Consent</strong>: Explicit checkbox consent required before first save</li>
<li><strong>No Personal Data</strong>: System only stores simulation JSON, no user identification</li>
<li><strong>Private Repository</strong>: All simulations stored in private GitHub repository</li>
</ul>
<h2>Non-Destructive Architecture Benefits</h2>
<h3>Why Non-Destructive?</h3>
<p>The original plan included "update" functionality that would overwrite existing simulations. This was changed to a non-destructive approach for several critical reasons:</p>
<ol>
<li><strong>Security</strong>: Prevents malicious users from guessing save codes and destroying others' work</li>
<li><strong>Data Integrity</strong>: Ensures no simulation data is ever lost</li>
<li><strong>Audit Trail</strong>: Maintains complete history for debugging and analysis</li>
<li><strong>Future Features</strong>: Enables diff, merge, and collaboration features</li>
</ol>
<h3>Implementation Details</h3>
<ul>
<li><strong>Always Generate New Codes</strong>: Every save operation creates a unique save code</li>
<li><strong>Preserve Lineage</strong>: Track parent-child relationships through <code>previousSaveCode</code></li>
<li><strong>Immutable Storage</strong>: Once saved, simulation files are never modified</li>
<li><strong>Version Trees</strong>: Multiple users can branch from the same parent simulation</li>
</ul>
<h2>User Experience Flow</h2>
<h3>First-Time Save Experience</h3>
<ol>
<li>User creates or modifies a simulation in the playground</li>
<li>User clicks "Save Simulation" button</li>
<li>Privacy warning modal appears with detailed explanation</li>
<li>User must check consent checkbox to enable save button</li>
<li>System validates JSON and sends to server</li>
<li>Server generates unique save code and stores simulation with metadata</li>
<li>Success modal displays save code with copy-to-clipboard functionality</li>
<li>User's consent choice persists for future saves in this browser</li>
</ol>
<h3>Subsequent Save Experience</h3>
<ol>
<li>User clicks "Save Simulation" button</li>
<li>Privacy warning is skipped (already consented)</li>
<li>Save process proceeds immediately</li>
<li>New save code generated (even if loaded from existing simulation)</li>
<li>Lineage preserved through <code>previousSaveCode</code> field</li>
</ol>
<h3>Load Experience</h3>
<ol>
<li>User clicks "Load Simulation" button</li>
<li>Modal opens with formatted input field (auto-uppercase, 16-char limit)</li>
<li>User enters or pastes save code</li>
<li>System validates format and sends request to server</li>
<li>Server retrieves simulation from GitHub repository</li>
<li>JSON data loaded into Monaco editor</li>
<li>Simulation automatically renders in the visualization panel</li>
<li>Success notification appears briefly</li>
</ol>
<h2>Error Handling</h2>
<h3>Frontend Error Scenarios</h3>
<ul>
<li><strong>Invalid JSON</strong>: User attempts to save malformed JSON</li>
<li><strong>Network Failure</strong>: API server unreachable or slow</li>
<li><strong>Invalid Save Code</strong>: User enters non-existent or malformed save code</li>
<li><strong>Server Errors</strong>: API returns error response</li>
</ul>
<h3>Backend Error Scenarios</h3>
<ul>
<li><strong>GitHub API Failures</strong>: Rate limiting, authentication issues, repository problems</li>
<li><strong>Save Code Collisions</strong>: Extremely rare but handled with retry logic</li>
<li><strong>Invalid Payloads</strong>: Malformed requests from frontend</li>
<li><strong>Storage Failures</strong>: Disk space, permission issues</li>
</ul>
<h3>Error Messages</h3>
<p>All error messages are user-friendly and actionable:</p>
<ul>
<li><strong>Save Errors</strong>: "Save failed: Please check your internet connection and try again"</li>
<li><strong>Load Errors</strong>: "Save code not found: Please verify the code and try again"</li>
<li><strong>Validation Errors</strong>: "Please fix JSON errors before saving"</li>
</ul>
<h2>Future Enhancement Possibilities</h2>
<h3>Planned Features</h3>
<ol>
<li><strong>Diff Visualization</strong>: Show changes between parent and child simulations</li>
<li><strong>Version History Browser</strong>: Navigate through simulation evolution</li>
<li><strong>Popular Simulations</strong>: Identify most-used base simulations</li>
<li><strong>Collaboration Tools</strong>: Share and iterate on simulations</li>
</ol>
<h2>Conclusion</h2>
<p>The Universal Automation Wiki playground save/load system provides a robust, secure, and user-friendly way for users to persist and share their simulations. The non-destructive architecture ensures data integrity while enabling powerful future features. The system successfully bridges the gap between static site limitations and modern web application functionality.</p>
<p>The implementation demonstrates several key architectural patterns:</p>
<ul>
<li><strong>Progressive Enhancement</strong>: Static site enhanced with dynamic features</li>
<li><strong>Service-Oriented Architecture</strong>: Clean separation between frontend, API, and storage</li>
<li><strong>Security by Design</strong>: Privacy warnings and consent management</li>
<li><strong>Future-Proof Design</strong>: Metadata structure supports planned enhancements</li>
</ul>
<p>This system serves as a foundation for more advanced collaboration and analysis features while maintaining the simplicity and reliability that users expect from the Universal Automation Wiki platform.</p>
            </section>

        </main>
    </div>

    <div id="footer-placeholder"></div>

    <script src="/assets/js/components.js"></script>
<script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/documentation.js"></script>
    <script>renderDocumentationSidebar('#sidebar-placeholder');</script>
</body>
</html>